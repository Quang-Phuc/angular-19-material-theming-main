<!-- Trang AI g·∫ßn nh∆∞ tr·ªëng, ch·ªâ ƒë·ªÉ n·ªÅn ph√≠a sau popup -->
<main class="ai-page">
  <!-- N·∫øu mu·ªën, c√≥ th·ªÉ ƒë·ªÉ m·ªôt d√≤ng nh·ªè ·ªü tr√™n n·ªÅn, c√≤n hi·ªán t·∫°i ƒë·ªÉ tr·ªëng cho s·∫°ch -->
</main>

<!-- POPUP 1: B·∫¢NG GI√Å (m·∫∑c ƒë·ªãnh ƒëang m·ªü v√¨ showPricingModal = true) -->
<section class="pricing-backdrop" *ngIf="showPricingModal">
  <div class="pricing-sheet">
    <header class="pricing-header">
      <div>
        <h2>B·∫£ng gi√° soi c·∫ßu AI</h2>
        <p>Ch·ªçn g√≥i ph√π h·ª£p v·ªõi nhu c·∫ßu c·ªßa b·∫°n.</p>
      </div>
      <button class="close-btn" type="button" (click)="closePricing()">‚úï</button>
    </header>

    <div class="pricing-body">
      <div class="pricing-grid">
        <article
          class="pricing-card"
          *ngFor="let p of plans"
          (click)="openPlanDetail(p)">
          <div class="card-inner">
            <div class="card-top">
              <div class="card-label">
                <span class="badge">{{ p.code }}</span>
                <span class="label-text">{{ p.title }}</span>
              </div>

              <div class="card-hero">
                <div class="hero-icon">
                  <span *ngIf="p.id === 1">üîÆ</span>
                  <span *ngIf="p.id === 2">üß†</span>
                  <span *ngIf="p.id === 3">üëë</span>
                </div>
                <div class="hero-info">
                  <div class="hero-sub">{{ p.heroSubtitle }}</div>
                  <div class="hero-name">{{ p.heroName }}</div>
                </div>
              </div>

              <div class="card-price">
                <div class="old" *ngIf="p.oldPriceLabel">
                  <span class="strike">{{ p.oldPriceLabel }}</span>
                </div>
                <div class="main-price">
                  <span class="number">{{ p.priceLabel }}</span>
                  <span class="unit" *ngIf="!p.isFree">/ l·∫ßn</span>
                  <span class="unit" *ngIf="p.isFree">/ m·ªói ng√†y</span>
                </div>
                <div class="card-highlight">
                  {{ p.highlightLine }}
                </div>
                <div class="card-highlight-sub" *ngIf="p.highlightSub">
                  {{ p.highlightSub }}
                </div>

                <div class="most-tag" *ngIf="p.id === 2">
                  ‚≠ê Ph·ªï bi·∫øn nh·∫•t
                </div>
              </div>
            </div>

            <div class="card-features">
              <ul>
                <ng-container *ngFor="let line of p.perks; let i = index">
                  <li *ngIf="i < 3 || expandedPlan.has(p.id)">
                    {{ line }}
                  </li>
                </ng-container>
              </ul>

              <button
                *ngIf="p.perks.length > 3"
                type="button"
                class="see-more"
                (click)="toggleExpand(p, $event)">
                {{ expandedPlan.has(p.id) ? 'Thu g·ªçn' : 'Xem th√™m' }}
              </button>
            </div>

            <div class="card-footer">
              <button
                type="button"
                class="card-cta"
                [class.free]="p.isFree"
                (click)="openPlanDetail(p, $event)">
                {{ p.isFree ? 'Xem d·ª± ƒëo√°n Free' : 'Ch·ªçn g√≥i n√†y' }}
              </button>
            </div>
          </div>
        </article>
      </div>
    </div>
  </div>
</section>

<!-- POPUP 2: CHI TI·∫æT G√ìI + CHUY·ªÇN KHO·∫¢N / CODE -->
<section class="detail-backdrop" *ngIf="showDetailModal">
  <div class="detail-modal" *ngIf="selectedPlan as sp">
    <header class="detail-header">
      <div class="detail-title">
        <h3>G√≥i {{ sp.code }} ‚Äì {{ sp.heroName }}</h3>
        <p *ngIf="sp.isFree; else paidTitle">
          L∆∞·ª£t soi mi·ªÖn ph√≠ (demo).
        </p>
        <ng-template #paidTitle>
          <p>H∆∞·ªõng d·∫´n chuy·ªÉn kho·∫£n & nh·∫≠p m√£ code k√≠ch ho·∫°t.</p>
        </ng-template>
      </div>
      <button type="button" class="close-btn" (click)="closeDetail()">‚úï</button>
    </header>

    <div class="detail-body">
      <ng-container *ngIf="sp.isFree; else paidBlock">
        <p class="detail-text">
          M·ªói ng√†y b·∫°n c√≥ 1 l∆∞·ª£t soi FREE v·ªõi g√≥i
          <strong>{{ sp.code }}</strong>. Giai ƒëo·∫°n demo ch∆∞a t√≠ch h·ª£p qu·∫£ng
          c√°o, b·∫°n c√≥ th·ªÉ b·∫•m <strong>"Xem d·ª± ƒëo√°n ngay"</strong> ph√≠a d∆∞·ªõi ƒë·ªÉ
          g·ªçi API Th·∫ßn ƒê√®n AI.
        </p>
      </ng-container>

      <ng-template #paidBlock>
        <section class="bank-box">
          <h4>1. Chuy·ªÉn kho·∫£n ƒë√∫ng th√¥ng tin</h4>
          <ul>
            <li><strong>Ng√¢n h√†ng:</strong> {{ bankInfo.bankName }}</li>
            <li><strong>Ch·ªß TK:</strong> {{ bankInfo.owner }}</li>
            <li><strong>S·ªë t√†i kho·∫£n:</strong> {{ bankInfo.number }}</li>
            <li>
              <strong>N·ªôi dung:</strong> {{ bankInfo.contentHint }} ‚Ä¢ G√≥i
              {{ sp.code }}
            </li>
            <li><strong>S·ªë ti·ªÅn:</strong> {{ sp.priceLabel }}</li>
          </ul>
          <p class="detail-note">
            Sau khi nh·∫≠n ƒë∆∞·ª£c chuy·ªÉn kho·∫£n, admin s·∫Ω g·ª≠i
            <strong>m√£ code k√≠ch ho·∫°t</strong> qua Zalo / SMS cho b·∫°n.
          </p>
        </section>

        <section class="code-box">
          <h4>2. Nh·∫≠p m√£ code k√≠ch ho·∫°t</h4>
          <input
            type="text"
            [(ngModel)]="codeInput"
            placeholder="Nh·∫≠p m√£ code b·∫°n nh·∫≠n ƒë∆∞·ª£c..."
          />
          <button
            class="btn-code"
            type="button"
            [disabled]="activating"
            (click)="activateWithCode()">
            {{ activating ? 'ƒêang ki·ªÉm tra...' : 'K√≠ch ho·∫°t m√£ code' }}
          </button>
        </section>
      </ng-template>

      <div class="result-panel" *ngIf="activationMsg">
        {{ activationMsg }}
      </div>

      <p class="detail-note small" *ngIf="sp.note">{{ sp.note }}</p>
    </div>

    <footer class="detail-footer">
      <button class="cta-main" type="button" (click)="viewPrediction()">
        Xem d·ª± ƒëo√°n ngay
      </button>
      <button class="cta-secondary" type="button" (click)="closeDetail()">
        ƒê√≥ng
      </button>
    </footer>
  </div>
</section>
