<!-- src/app/pages/ai/ai-page.component.html -->
<main class="ai-page">
  <header class="ai-header">
    <div class="ai-title">
      <span class="spark">‚ú®</span>
      <div>
        <h1>D·ª± ƒêo√°n X·ªï S·ªë B·∫±ng AI</h1>
        <p>
          K·∫øt h·ª£p d·ªØ li·ªáu l·ªãch s·ª≠ + m√¥ h√¨nh GPT-5.1 ƒë·ªÉ g·ª£i √Ω nh·ªØng con s·ªë
          ‚Äús√°ng‚Äù nh·∫•t ‚Äì ch·ªâ d√πng cho m·ª•c ƒë√≠ch tham kh·∫£o, kh√¥ng ƒë·∫£m b·∫£o tr√∫ng.
        </p>
      </div>
    </div>
  </header>

  <section class="plan-grid">
    <!-- G√ìI 1 ‚Äì FREE -->
    <article
      class="plan-card plan-free"
      *ngFor="let p of plans"
      (click)="openPlan(p)">
      <div class="plan-inner">
        <div class="plan-top">
          <div class="plan-label">
            <span class="star">‚≠ê</span>
            <span class="code">{{ p.title }}</span>
          </div>
          <div class="hero">
            <div class="hero-avatar">
              <!-- c√≥ th·ªÉ thay b·∫±ng ·∫£nh sau -->
              <span *ngIf="p.id === 1">üîÆ</span>
              <span *ngIf="p.id === 2">üß†</span>
              <span *ngIf="p.id === 3">üëë</span>
            </div>
            <div class="hero-text">
              <div class="hero-sub">{{ p.heroSubtitle }}</div>
              <div class="hero-name">{{ p.heroName }}</div>
            </div>
          </div>

          <div class="price-block">
            <div class="old-price" *ngIf="p.oldPriceLabel">
              Gi√° g·ªëc:
              <span class="strike">{{ p.oldPriceLabel }}</span>
            </div>
            <div class="price-main" [class.free]="p.isFree">
              {{ p.isFree ? p.priceLabel : p.priceLabel }}
            </div>
            <div class="highlight">
              {{ p.highlightLine }}
            </div>
            <div class="highlight-sub" *ngIf="p.highlightSub">
              {{ p.highlightSub }}
            </div>
          </div>

          <div class="divider"></div>

          <div class="perks">
            <h4>‚úÖ Bao g·ªìm:</h4>
            <ul>
              <li *ngFor="let line of p.perks">
                {{ line }}
              </li>
            </ul>
          </div>

          <p class="note" *ngIf="p.note">{{ p.note }}</p>
        </div>

        <div class="plan-footer">
          <button
            type="button"
            class="cta"
            [class.free]="p.isFree"
            (click)="openPlan(p); $event.stopPropagation()">
            {{ p.isFree ? 'Xem D·ª± ƒêo√°n Ngay' : 'Mua G√≥i Ngay' }}
          </button>
        </div>
      </div>
    </article>
  </section>

  <!-- MODAL: TH√îNG TIN CHUY·ªÇN KHO·∫¢N + NH·∫¨P CODE -->
  <section class="modal-backdrop" *ngIf="showModal">
    <div class="modal" *ngIf="selectedPlan as sp">
      <header class="modal-header">
        <div class="modal-title">
          <span>Th√¥ng Tin {{ sp.isFree ? 'S·ª≠ D·ª•ng' : 'Chuy·ªÉn Kho·∫£n' }}</span>
        </div>
        <button class="modal-close" (click)="closeModal()">‚úï</button>
      </header>

      <div class="modal-body">
        <!-- FREE: ch·ªâ ghi ch√∫ -->
        <ng-container *ngIf="sp.isFree; else paidBlock">
          <p class="modal-text">
            G√≥i <strong>{{ sp.title }}</strong> ‚Äì {{ sp.heroName }}.
          </p>
          <p class="modal-text">
            Giai ƒëo·∫°n demo: ch∆∞a t√≠ch h·ª£p qu·∫£ng c√°o, b·∫°n c√≥ th·ªÉ b·∫•m
            <strong>‚ÄúXem D·ª± ƒêo√°n Ngay‚Äù</strong> ƒë·ªÉ g·ªçi API soi c·∫ßu.
          </p>
        </ng-container>

        <!-- PAID PLANS -->
        <ng-template #paidBlock>
          <div class="bank-panel">
            <h3>1. Chuy·ªÉn kho·∫£n g√≥i {{ sp.code }}</h3>
            <p>Vui l√≤ng chuy·ªÉn kho·∫£n ƒë√∫ng n·ªôi dung ƒë·ªÉ h·ªá th·ªëng d·ªÖ ki·ªÉm tra:</p>
            <ul>
              <li>
                <strong>Ng√¢n h√†ng:</strong> {{ bankInfo.bankName }}
              </li>
              <li>
                <strong>Ch·ªß TK:</strong> {{ bankInfo.owner }}
              </li>
              <li>
                <strong>S·ªë TK:</strong> {{ bankInfo.number }}
              </li>
              <li>
                <strong>N·ªôi dung:</strong> {{ bankInfo.contentHint }}
              </li>
              <li>
                <strong>S·ªë ti·ªÅn:</strong> {{ sp.priceLabel }}
              </li>
            </ul>
            <p class="hint">
              Sau khi nh·∫≠n ƒë∆∞·ª£c chuy·ªÉn kho·∫£n, admin s·∫Ω g·ª≠i
              <strong>m√£ code k√≠ch ho·∫°t</strong> g√≥i {{ sp.code }} qua Zalo /
              SMS cho b·∫°n.
            </p>
          </div>

          <div class="code-panel">
            <h3>2. Nh·∫≠p m√£ code k√≠ch ho·∫°t</h3>
            <input
              type="text"
              [(ngModel)]="codeInput"
              placeholder="Nh·∫≠p m√£ code b·∫°n nh·∫≠n ƒë∆∞·ª£c..."
            />
            <button
              type="button"
              class="btn-code"
              [disabled]="activating"
              (click)="activateWithCode()">
              {{ activating ? 'ƒêang ki·ªÉm tra...' : 'K√≠ch Ho·∫°t M√£ Code' }}
            </button>
          </div>
        </ng-template>

        <div class="result-panel" *ngIf="activationMsg">
          {{ activationMsg }}
        </div>
      </div>

      <footer class="modal-footer">
        <button
          type="button"
          class="cta full"
          (click)="viewPrediction()">
          Xem D·ª± ƒêo√°n Ngay
        </button>
        <button type="button" class="secondary" (click)="closeModal()">
          ƒê√≥ng
        </button>
      </footer>
    </div>
  </section>
</main>
