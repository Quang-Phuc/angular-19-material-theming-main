/* src/app/core/dialogs/pledge-dialog/pledge-dialog.component.scss */

/* === BIẾN MÀU (Giữ nguyên) === */
$color-header-bg: #004d40;
$color-customer-bg: #e8f5e9;
$color-customer-border: #c8e6c9;
$color-dropzone-bg: #f8f9fa;
$color-dropzone-border: #dee2e6;
$color-portrait-border: #cde4e2;
$color-focus: $color-header-bg;
$color-block-border: #e9ecef;
$color-dialog-bg: #f4f6f9; // Sẽ dùng màu này làm nền
$color-green-success: #28a745;
$color-gray-cancel: #6c757d;
$color-loan-bg: #e3f2fd;

/* === HIỆU ỨNG (Giữ nguyên) === */
@keyframes fadeInDown {
  from { opacity: 0; transform: translateY(-15px); }
  to { opacity: 1; transform: translateY(0); }
}

/* === CƠ BẢN === */
:host { display: block; }

/* === QUAN TRỌNG: BỎ CHIỀU CAO CỐ ĐỊNH ===
  Bỏ dòng này đi. Hãy để Angular Material dùng chiều cao mặc định (56px)
  cho 'appearance="outline"'. Điều này sẽ làm form thoáng và
  căn chỉnh chuẩn hơn.
*/
/* mat-form-field {
  ::ng-deep .mat-mdc-form-field-flex { height: 48px; }
}
*/

/* Sửa lại mat-dialog-title để dùng thẻ chuẩn mat-dialog-title */
h2[mat-dialog-title].dialog-title {
  background-color: $color-header-bg;
  color: white;
  margin: -24px -24px 16px -24px;
  padding: 16px 24px;
  /* Bỏ border-radius vì dialog đã có rồi */
}

.progress-bar-placeholder { height: 4px; }

mat-dialog-content {
  padding: 8px 2px; // Giảm padding 2 bên
  background-color: $color-dialog-bg; // Dùng màu nền
  max-height: 75vh;
  overflow-y: auto;
}

/* BỎ HOÀN TOÀN .content-block VÀ CÁC CLASS TƯƠNG TỰ */
/* .content-block { ... } */
/* .loan-info-section { ... } */
/* .customer-info-box { ... } */


/* === FORM FIELD FOCUS & HOVER (Giữ nguyên, rất tốt) === */
mat-form-field {
  transition: all .3s ease;
  &:hover {
    ::ng-deep .mdc-notched-outline-leading,
    ::ng-deep .mdc-notched-outline-notch,
    ::ng-deep .mdc-notched-outline-trailing {
      border-color: $color-focus; border-width: 1px;
    }
  }
  &.mat-focused {
    ::ng-deep .mdc-notched-outline-leading,
    ::ng-deep .mdc-notched-outline-notch,
    ::ng-deep .mdc-notched-outline-trailing {
      border-width: 2px;
    }
  }
}

/* === STYLING CHO BỐ CỤC PANEL MỚI === */
mat-accordion {
  // Bỏ shadow mặc định của accordion
  box-shadow: none !important;
  background: transparent;
  padding: 8px 16px; // Thêm padding cho nội dung
}

mat-expansion-panel {
  margin-bottom: 20px !important; // Khoảng cách giữa các panel
  border-radius: 8px !important; // Bo góc
  background-color: #fff; // Nền trắng

  // Áp dụng shadow đẹp của bạn vào đây
  box-shadow: 0 2px 5px rgba(0,0,0,0.05) !important;
  transition: box-shadow .3s ease !important;

  &:hover {
    box-shadow: 0 4px 10px rgba(0,0,0,0.07) !important;
  }

  // Tùy chỉnh Header
  mat-expansion-panel-header {
    font-weight: 600; // In đậm tiêu đề
    font-size: 1.1rem;
    color: $color-header-bg;
  }

  // Thêm padding cho nội dung bên trong panel
  .mat-expansion-panel-body {
    padding: 16px 24px 24px 24px;
  }

  // Bỏ shadow khi panel lồng nhau (như panel Phí)
  mat-expansion-panel {
    box-shadow: none !important;
    border: 1px solid #eee;
    margin-top: 16px;
  }
}


/* CUSTOMER INFO BOX (Giữ nguyên, chỉ đổi tên selector) */
.customer-main-grid {
  display: grid;
  grid-template-columns: 200px 1fr;
  gap: 24px;
  align-items: flex-start;
}
.portrait-capture-box {
  border: 2px dashed $color-portrait-border;
  background-color: #f0f7f7;
  border-radius: 8px;
  padding: 16px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  text-align: center;
  height: 230px;
  gap: 12px;
  transition: all .3s ease;
  mat-icon { font-size: 80px; width: 80px; height: 80px; color: #80cbc4; }
  span { font-weight: 600; color: $color-header-bg; }
  .capture-btn, .upload-btn { width: 100%; }
  &:hover { border-color: $color-focus; background-color: #fff; }
  .portrait-preview { max-width: 100%; max-height: 140px; border-radius: 8px; object-fit: cover; margin-bottom: 8px; }
}

/* WEBCAM MODAL (Giữ nguyên) */
.webcam-modal {
  position: fixed; top:0; left:0; right:0; bottom:0;
  background: rgba(0,0,0,.5); display:flex; align-items:center; justify-content:center; z-index:1000;
}
.webcam-modal-content {
  background:#fff; border-radius:8px; padding:16px; width:90%; max-width:500px; text-align:center;
  box-shadow:0 4px 10px rgba(0,0,0,.2);
  h3 { margin:0 0 16px; color:$color-header-bg; font-weight:600; }
  .webcam-video { width:100%; max-height:300px; border-radius:8px; background:#000; }
  .webcam-actions { margin-top:16px; display:flex; justify-content:flex-end; gap:8px; }
}

/* SUB TABS (Giữ nguyên) */
.sub-tabs {
  animation: fadeInDown .5s ease;
  ::ng-deep .mat-mdc-tab-header { border-bottom:none; }
  .tab-content { padding:20px 16px; border:1px solid #e0e0e0; border-top:none; border-radius:0 0 8px 8px; }
}

/* === TINH CHỈNH GRID === */
.form-grid-2-col, .form-grid-3-col, .form-grid-4-col {
  display: grid;
  gap: 20px; // Tăng khoảng cách
  align-items: start; // Căn chỉnh theo đầu, trông đẹp hơn là center
}
.form-grid-2-col { grid-template-columns:repeat(2,1fr); }
.form-grid-3-col { grid-template-columns:repeat(3,1fr); }
.form-grid-4-col { grid-template-columns:repeat(4,1fr); }
.full-width { width:100%; }
hr { border:none; border-top:1px solid #eee; margin:16px 0; }

/* === CLASS GRID MỚI ĐỂ CĂN NÚT === */
.form-grid-asset-with-button {
  display: grid;
  grid-template-columns: 1fr 1fr auto; // Cột auto cho nút
  gap: 20px;
  align-items: center; // Center để căn nút vào giữa form field
}

/* ADD ASSET TYPE BUTTON (Chỉnh lại 1 chút) */
.add-asset-type-btn {
  height: 56px !important; // CĂN BẰNG CHIỀU CAO MỚI CỦA FORM FIELD
  min-height: 56px !important; //
  line-height: 56px !important; //
  padding: 0 20px !important; // Tăng padding
  border-radius: 8px !important;
  background-color:$color-green-success !important; color:#fff !important;
  font-weight:500 !important; text-transform:none !important;
  box-shadow:0 2px 5px rgba(40,167,69,.3); transition:all .3s ease;
  display:flex !important; align-items:center; justify-content:center; gap:6px;
  mat-icon { font-size:20px; width:20px; height:20px; margin:0 !important; }
  span { font-size:.95rem; }
  &:hover { background-color:darken($color-green-success,8%) !important;
    box-shadow:0 4px 8px rgba(40,167,69,.4); transform:translateY(-1px); }
  &:active { transform:translateY(0); }
}

/* INTEREST GROUP (Giữ nguyên) */
.interest-group-grid {
  display:grid; grid-template-columns:1fr 1fr 1fr 1fr; gap:16px; margin:16px 0; align-items:end;
  @media (max-width:1024px) { grid-template-columns:1fr 1fr; }
  @media (max-width:768px) { grid-template-columns:1fr; }
}
.interest-item { display:flex; flex-direction:column; gap:6px;
  .interest-label { font-weight:500; color:$color-header-bg; font-size:.9rem; }
}
.input-group {
  display:flex; border:1px solid #d0d0d0; border-radius:6px; overflow:hidden;
  transition:all .3s ease; background:#fff;
  &:has(input:focus), &:has(mat-select:focus) {
    border-color:$color-focus; box-shadow:0 0 0 3px rgba($color-focus,.15);
  }
  .number-input { flex:1; border:none; padding:0 12px; height:44px; font-size:1rem; outline:none; min-width:60px; }
  .unit-select { width:140px; border-left:1px solid #e0e0e0; background:#fafafa;
    ::ng-deep .mat-mdc-select-trigger { height:44px; padding:0 12px; font-size:.95rem; }
  }
}
.compact-field {
  ::ng-deep .mat-mdc-form-field-flex { height:44px !important; }
  ::ng-deep .mat-mdc-text-field-wrapper { padding:0 8px; }
}

/* FEE GRID (Giữ nguyên) */
.fee-grid {
  display:grid; grid-template-columns:1fr 180px 200px; gap:16px; align-items:center; margin-bottom:8px;
  label { font-weight:500; }
  mat-form-field {
    ::ng-deep .mat-mdc-form-field-flex { height:44px !important; }
    ::ng-deep .mat-mdc-form-field-subscript-wrapper { display:none; }
  }
  mat-radio-group { display:flex; gap:16px; }
}

/* FILE DROPZONE (Giữ nguyên) */
.file-dropzone {
  border:2px dashed $color-dropzone-border; background:$color-dropzone-bg;
  border-radius:8px; padding:24px; display:flex; flex-direction:column;
  align-items:center; justify-content:center; text-align:center; cursor:pointer;
  transition:all .3s ease;
  mat-icon { font-size:48px; width:48px; height:48px; color:#adb5bd; }
  span { font-weight:600; font-size:1.1rem; margin-top:8px; }
  .dropzone-subtext { font-size:.85rem; color:#6c757d; margin-bottom:16px; }
  &:hover { border-color:$color-focus; background:#fff; }
  &.drag-over { border-color:$color-focus; background:#e3f2fd; }
}
.attachment-upload-link { margin-top:16px; a { color:#0d6efd; text-decoration:none; font-weight:500;
  display:inline-flex; align-items:center; gap:4px;
  mat-icon { font-size:20px; width:20px; height:20px; }
  &:hover { text-decoration:underline; cursor:pointer; }
}}
.uploaded-files-list { margin-top:16px; max-height:200px; overflow-y:auto; }

/* DIALOG ACTIONS (GiVới nguyên) */
mat-dialog-actions {
  padding:16px 24px; border-top:1px solid #eee;
  margin:16px -24px -24px -24px; background:#fdfdfd;
  .cancel-button { border-color:#ced4da; color:$color-gray-cancel;
    &:hover { background:#f1f3f5; }
  }
  .save-button { background:$color-green-success; color:#fff;
    &:hover { background:darken($color-green-success,8%); }
  }
}

/* RESPONSIVE (Cập nhật cho grid mới) */
@media (max-width: 1024px) {
  .form-grid-3-col, .form-grid-4-col { grid-template-columns:repeat(2,1fr); }
  .fee-grid { grid-template-columns:1fr; gap:8px; mat-form-field, mat-radio-group { margin-top:-8px; } }

  .form-grid-asset-with-button {
    grid-template-columns: 1fr 1fr; // Nút sẽ rớt xuống
    .add-asset-type-btn {
      grid-column: 1 / -1; // Chiếm cả hàng
    }
  }
}
@media (max-width: 768px) {
  .customer-main-grid { grid-template-columns:1fr; }
  .portrait-capture-box { height:auto; max-width:300px; margin:0 auto 16px auto; }
  .form-grid-2-col, .form-grid-3-col, .form-grid-4-col,
  .form-grid-asset-with-button {
    grid-template-columns: 1fr; // Tất cả 1 cột
  }
  .add-asset-type-btn { width:100%; justify-content:center; margin-top:0 !important; }
  .webcam-modal-content { width:95%; }
}

/* (Các style khác giữ nguyên) */
.confirm-snackbar {
  .mat-snack-bar-container {
    background: #e3f2fd; color: #004d40; font-weight: 500; max-width: 500px;
  }
  .mat-snack-bar-cancel {
    background: transparent; color: #d32f2f; border: none; font-weight: 500;
    cursor: pointer; margin-left: 12px;
  }
}

/* === KHO DROPDOWN - THÊM KHO MỚI === */
::ng-deep .add-warehouse-btn {
  width: 100%;
  justify-content: flex-start;
  text-align: left;
  font-weight: 500;
  color: #004d40 !important;
  mat-icon {
    font-size: 18px;
    width: 18px;
    height: 18px;
    margin-right: 8px;
  }
}

::ng-deep .add-new-option {
  padding: 0 !important;
  border-top: 1px solid #eee;
  background: #f8f9fa;
}
.kho-row {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-top: 4px;

  .flex-grow {
    flex: 1;
  }

  .add-warehouse-btn {
    height: 56px; // khớp chiều cao form-field
    min-width: 56px;
    display: flex;
    align-items: center;
    justify-content: center;
  }
}

.kho-row {
  display: flex;
  align-items: center;
  gap: 8px;

  .flex-grow {
    flex: 1;
  }

  .add-warehouse-mini-btn {
    background: linear-gradient(135deg, #1976d2, #42a5f5);
    color: #fff;
    box-shadow: 0 2px 6px rgba(25, 118, 210, 0.4);
    transition: all 0.25s ease;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    min-width: unset;

    &:hover {
      background: linear-gradient(135deg, #1565c0, #64b5f6);
      box-shadow: 0 4px 10px rgba(25, 118, 210, 0.5);
      transform: translateY(-1px);
    }

    mat-icon {
      font-size: 22px;
    }
  }
}
