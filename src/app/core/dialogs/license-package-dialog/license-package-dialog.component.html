<!-- src/app/core/dialogs/license-package-dialog/license-package-dialog.component.html (TỆP MỚI) -->
@if (isLoading) {
  <mat-progress-bar mode="indeterminate" class="dialog-progress-bar"></mat-progress-bar>
}

<h2 mat-dialog-title>{{ isEditMode ? 'Cập nhật Gói License' : 'Thêm Gói mới' }}</h2>

<form [formGroup]="packageForm" (ngSubmit)="onSave()">
  <mat-dialog-content class="dialog-content">

    <!-- Tên Gói -->
    <mat-form-field appearance="outline">
      <mat-label>Tên Gói</mat-label>
      <input matInput formControlName="name" cdkFocusInitial>
      @if (packageForm.get('name')?.hasError('required')) {
        <mat-error>Vui lòng nhập tên gói</mat-error>
      }
    </mat-form-field>

    <!-- Mô tả -->
    <mat-form-field appearance="outline">
      <mat-label>Mô tả (Tùy chọn)</mat-label>
      <textarea matInput formControlName="description" mat-maxlength="500"></textarea>
    </mat-form-field>

    <!-- Hàng 1: Giá và Giảm giá -->
    <div class="form-row">
      <mat-form-field appearance="outline">
        <mat-label>Giá</mat-label>
        <input matInput formControlName="price" type="number" min="0">
        <span matTextSuffix>đ</span>
        @if (packageForm.get('price')?.hasError('required')) {
          <mat-error>Vui lòng nhập giá</mat-error>
        }
        @if (packageForm.get('price')?.hasError('min')) {
          <mat-error>Giá phải >= 0</mat-error>
        }
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Giảm giá (Tùy chọn)</mat-label>
        <input matInput formControlName="discount" type="number" min="0" max="100">
        <span matTextSuffix>%</span>
        @if (packageForm.get('discount')?.hasError('min') || packageForm.get('discount')?.hasError('max')) {
          <mat-error>Giảm giá từ 0 - 100</mat-error>
        }
      </mat-form-field>
    </div>

    <!-- Hàng 2: Thời hạn -->
    <mat-form-field appearance="outline">
      <mat-label>Thời hạn sử dụng</mat-label>
      <input matInput formControlName="durationDays" type="number" min="1">
      <span matTextSuffix>ngày</span>
      @if (packageForm.get('durationDays')?.hasError('required')) {
        <mat-error>Vui lòng nhập thời hạn</mat-error>
      }
      @if (packageForm.get('durationDays')?.hasError('min')) {
        <mat-error>Thời hạn phải >= 1 ngày</mat-error>
      }
    </mat-form-field>

    <!-- Hàng 3: Giới hạn -->
    <div class="form-row">
      <mat-form-field appearance="outline">
        <mat-label>Số tiệm tối đa (Tùy chọn)</mat-label>
        <input matInput formControlName="maxStore" type="number" min="0">
        @if (packageForm.get('maxStore')?.hasError('min')) {
          <mat-error>Phải >= 0</mat-error>
        }
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Số user/tiệm tối đa (Tùy chọn)</mat-label>
        <input matInput formControlName="maxUserPerStore" type="number" min="0">
        @if (packageForm.get('maxUserPerStore')?.hasError('min')) {
          <mat-error>Phải >= 0</mat-error>
        }
      </mat-form-field>
    </div>

  </mat-dialog-content>

  <mat-dialog-actions align="end">
    <button mat-button type="button" (click)="onCancel()" [disabled]="isLoading">Hủy bỏ</button>
    <button mat-flat-button
            color="primary"
            type="submit"
            [disabled]="packageForm.invalid || isLoading">
      Lưu lại
    </button>
  </mat-dialog-actions>
</form>
