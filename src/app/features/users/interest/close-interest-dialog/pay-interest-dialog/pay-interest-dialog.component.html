<div class="dialog-wrapper" [@slideIn]>
  <div class="dialog-card">

    <!-- Header -->
    <div class="dialog-header">
      <div class="header-icon">
        <mat-icon>monetization_on</mat-icon>
      </div>
      <div class="header-title">
        <h2>Đóng lãi kỳ {{ data.periodNumber }}</h2>
        <p class="subtitle">Vui lòng nhập thông tin thanh toán</p>
      </div>
    </div>

    <!-- Form -->
    <mat-dialog-content class="dialog-content">
      <form [formGroup]="form" class="form">

        <!-- Ngày đóng -->
        <mat-form-field appearance="outline" class="custom-field" floatLabel="always">
          <mat-label>Ngày đóng</mat-label>
          <input matInput [matDatepicker]="payDatePicker" formControlName="payDate" required>
          <mat-datepicker-toggle matIconSuffix [for]="payDatePicker">
            <mat-icon matDatepickerToggleIcon>today</mat-icon>
          </mat-datepicker-toggle>
          <mat-datepicker #payDatePicker></mat-datepicker>
          <mat-error>Vui lòng chọn ngày</mat-error>
        </mat-form-field>

        <!-- Hình thức thanh toán -->
        <mat-form-field appearance="outline" class="custom-field" floatLabel="always">
          <mat-label>Hình thức thanh toán</mat-label>
          <mat-select formControlName="paymentMethod" required panelClass="custom-select-panel">
            <mat-option *ngFor="let method of paymentMethods" [value]="method.value" class="payment-option">
              <div class="option-content">
                <div class="method-badge" [style.background-color]="method.color">
                  <mat-icon>{{ method.icon }}</mat-icon>
                </div>
                <span class="method-label">{{ method.label }}</span>
              </div>
            </mat-option>
          </mat-select>
          <mat-error>Vui lòng chọn phương thức</mat-error>
        </mat-form-field>

        <!-- Số tiền -->
        <mat-form-field appearance="outline" class="custom-field" floatLabel="always">
          <mat-label>Số tiền khách đóng</mat-label>
          <span matPrefix class="currency-prefix">₫</span>
          <input matInput type="number" formControlName="amount" placeholder="0" required>
          <mat-error *ngIf="form.get('amount')?.hasError('required')">
            Vui lòng nhập số tiền
          </mat-error>
          <mat-error *ngIf="form.get('amount')?.hasError('min')">
            Số tiền phải > 0
          </mat-error>
        </mat-form-field>

        <!-- Ghi chú -->
        <mat-form-field appearance="outline" class="custom-field" floatLabel="always">
          <mat-label>Ghi chú (không bắt buộc)</mat-label>
          <textarea matInput rows="2" formControlName="note" placeholder="VD: Chuyển khoản lúc 14:30"></textarea>
        </mat-form-field>

      </form>
    </mat-dialog-content>

    <!-- Actions -->
    <mat-dialog-actions align="end" class="dialog-actions">
      <button mat-stroked-button class="btn-cancel" mat-dialog-close>Hủy</button>
      <button
        mat-flat-button
        class="btn-confirm gradient-btn"
        [disabled]="form.invalid || isSubmitting"
        (click)="confirm()">
        <span *ngIf="!isSubmitting">Xác nhận thanh toán</span>
        <mat-spinner *ngIf="isSubmitting" diameter="20"></mat-spinner>
      </button>
    </mat-dialog-actions>

  </div>
</div>
